<!DOCTYPE html>
<html manifest="./psychlops.appcache">

<head>
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
	<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<base href="./" />
	<title>Psychlops: Online Editor</title>
	<meta charset="utf-8" />

	<script src="import/gen/jquery-3.2.0.min.js"></script>
	<script src="import/gen/bootstrap.min.js"></script>
	<link rel="stylesheet" href="import/gen/bootstrap.min.css">
	<link rel="stylesheet" href="import/gen/bootstrap-theme.min.css">
	<link href="import/gen/bootstrap-toggle.min.css" rel="stylesheet">
	<script src="import/gen/bootstrap-toggle.min.js"></script>

	<script src="import/gen/sylvester.js" type="text/javascript"></script>
	<script src="import/gen/glUtils.js" type="text/javascript"></script>

	<script src="import/psychlops.0.8.0.js" type="text/javascript"></script>
	<script src="import/psychlops.cppconv.0.8.0.js" type="text/javascript"></script>
	<script src="import/psychlops.extensions.0.8.0.js" type="text/javascript"></script>
	<script src="psychlops.config.js" type="text/javascript"></script>

	<script src="import/gen/sprintf.js"></script>

	<script src="import/video/Decoder.js"></script>
	<script src="import/video/YUVCanvas.js"></script>
	<script src="import/video/Player.js"></script>
	<script src="import/video/stream.js"></script>
	<script src="import/video/mp4.js"></script>

	<link rel="stylesheet" href="import/codemirror/lib/codemirror.css">
	<script src="import/codemirror/lib/codemirror.js"></script>
	<script src="import/codemirror/mode/javascript/javascript.js"></script>
	<script src="import/codemirror/mode/clike/clike.js"></script>
	<script src="import/codemirror/addon/selection/active-line.js"></script>
	<script src="import/codemirror/addon/edit/matchbrackets.js"></script>

	<script src="import/codemirror/addon/search/searchcursor.js"></script>
	<script src="import/codemirror/addon/search/search.js"></script>
	<script src="import/codemirror/addon/scroll/annotatescrollbar.js"></script>
	<script src="import/codemirror/addon/search/matchesonscrollbar.js"></script>
	<link rel="stylesheet" href="import/codemirror/addon/dialog/dialog.css">
	<link href='https://fonts.googleapis.com/css?family=Source+Code+Pro' rel='stylesheet' type='text/css'>
	<script src="import/codemirror/addon/dialog/dialog.js"></script>

	<!-- CLM Tracker -->
	<script src="import/clm/libs/utils.js"></script>
	<script src="import/clm/clmtrackr.min.js"></script>
	<script src="import/clm/libs/Stats.js"></script>
	<script src="import/clm/models/model_pca_20_svm.js"></script>

	<link href='https://fonts.googleapis.com/css?family=Cabin+Condensed:700' rel='stylesheet' type='text/css'>
	<link href='https://fonts.googleapis.com/css?family=Roboto+Mono' rel='stylesheet' type='text/css'>

	<script src="import/gen/sjcl.js" type="text/javascript"></script>
	<script type="text/javascript">
		var cppEditor, jsEditor;
		var cppEditors = {}, jsEditors = {};
		var tabSettings = {};
		var CTRL_S_LAST_PUSHED = Date.now();
		var workingFile = "default";
		var args = null;
		var WINDOW_MESSAGE_REQUESTER = "https://psychlops.osdn.jp";
		var SELECTED_FILE = "";
		var CONFIGURE_GAMMA_CPP = "";
		var CONFIGURE_ISOLUMINANCE_CPP = "";
		var EDITOR_TEMPLATE = null;

		function run() {
			$("#psychlops_powersymbol").hide();
			Psychlops.Variables.debugMode = $('#debugmode_checkbox').prop('checked');
			if (Psychlops.Variables.debugMode) {
				$('#psychlops_watchlist_area').show();
			} else {
				$('#psychlops_watchlist_area').hide();
			}
			saveToAutosave(workingFile);
			var func = Psychlops.CodeConverter.compile($("#tab_" + tabSettings[workingFile].fileid + "_cpp").val());
			jsEditor.setValue(func);
			if (args == null) {
				Psychlops.Util.run(func);
			} else {
				Psychlops.Util.run(func, args);
			}
		}

		function preloadImage(evt) {
			var files = evt.target.files;
			for (var i = 0, f; f = files[i]; i++) {
				if (!f.type.match('image.*')) {
					continue;
				}
				var reader = new FileReader();
				reader.onload = (function (theFile) {
					return function (e) {
						Psychlops.Image.preload(theFile.name, e.target.result);
						$("#userimagefile_loaded").append($("<li>" + (theFile.name) + "</li>"));
					};
				})(f);
				reader.readAsDataURL(f);
			}
		}
		function pauseProgram() {
			Psychlops.Util.programPaused = true;
			$("#psychlops_pause_btn").attr("disabled", "disabled");
			$("#psychlops_restart_btn").removeAttr("disabled");
		}
		function restartProgram() {
			Psychlops.Util.programPaused = false;
			$("#psychlops_pause_btn").removeAttr("disabled");
			$("#psychlops_restart_btn").attr("disabled", "disabled");
		}
		function confirmSnapshotTimestamp(filename) {
			var tmptime = localStorage.getItem("Psychlops-editor-snapshot-timestamp-" + filename);
			if (tmptime == null) {
				return "no snapshot";
			} else {
				tmptime = Number(tmptime);
				var time = new Date();
				time.setTime(tmptime);
				if ((Date.now() - tmptime) > 24 * 60 * 1000) {
					return (1900 + time.getYear()) + " " + ("0" + (time.getMonth() + 1)).slice(-2) + "/" + ("0" + time.getDate()).slice(-2);
				} else {
					return ("0" + time.getHours()).slice(-2) + ":" + ("0" + time.getMinutes()).slice(-2);
				}
			}
		}
		function loadFromSnapshot(filename) {
			var tmpcode = localStorage.getItem("Psychlops-editor-snapshot-" + filename);
			if (tmpcode) { cppEditor.setValue(tmpcode); }
			notifyBottom("loaded snapshot.");
		}
		function saveToSnapshot(filename) {
			localStorage.setItem("Psychlops-editor-snapshot-" + filename, cppEditor.getValue());
			localStorage.setItem("Psychlops-editor-snapshot-timestamp-" + filename, Date.now());
			$("#file_load_snapshot_" + tabSettings[filename].fileid).html("Load (" + confirmSnapshotTimestamp(filename) + ")");
			notifyBottom("saved snapshot.");
		}
		function confirmAutosaveTimestamp(filename) {
			var tmptime = localStorage.getItem("Psychlops-editor-autosave-timestamp-" + filename);
			if (tmptime == null) {
				return "no autosave";
			} else {
				tmptime = Number(tmptime);
				var time = new Date();
				time.setTime(tmptime);
				if ((Date.now() - tmptime) > 24 * 60 * 1000) {
					return (1900 + time.getYear()) + " " + ("0" + (time.getMonth() + 1)).slice(-2) + "/" + ("0" + time.getDate()).slice(-2);
				} else {
					return ("0" + time.getHours()).slice(-2) + ":" + ("0" + time.getMinutes()).slice(-2);
				}
			}
		}
		function loadFromAutosave(filename) {
			var tmpcode = localStorage.getItem("Psychlops-editor-autosave-" + filename);
			if (tmpcode) { tabSettings[filename].cppEditor.setValue(tmpcode); }
		}
		function saveToAutosave(filename) {
			localStorage.setItem("Psychlops-editor-autosave-" + filename, cppEditor.getValue());
			localStorage.setItem("Psychlops-editor-autosave-timestamp-" + filename, Date.now());
			$("#file_load_autosave_" + tabSettings[filename].fileid).html("Load (" + confirmSnapshotTimestamp(filename) + ")");
		}
		function discardAutosave(filename) {
			loadFromServer(filename);
		}
		function loadFromOneDrive(filename) {
			document.getElementById('onedriveaccesser').contentWindow.postMessage("load:" + filename, WINDOW_MESSAGE_REQUESTER);
		}
		function saveToOneDrive(filename, data) {
			document.getElementById('onedriveaccesser').contentWindow.postMessage("save:" + filename + "\r\n" + data, WINDOW_MESSAGE_REQUESTER);
		}
		function loadFromServer(filename) {
			$.ajax({
				url: filename,
			}).done(function (data) {
				cppEditor.setValue(data);
				{
					cppEditor.focus();
					cppEditor.setCursor({ line: 30, ch: 10 });

					/*var span = document.createElement('span');
					span.textContent = 'hoge';
					cppEditor.eachLine(25, 35, function (line) {
						cppEditor.addLineClass(line, "background", "highlighted-code");
						cppEditor.addWidget({ line: 25, ch: 10 }, span);
					});
					//cppEditor.removeLineClass();*/
				}
			}).fail(function (data) {
				alert('Failed to load ' + filename + '.');
			});
		}
		function loadFromLocal(evt) {
			if (window.File && window.FileReader && window.FileList && window.Blob) {
				var files = evt.target.files;
				for (var i = 0, f; f = files[i]; i++) {
					var reader = new FileReader();
					reader.onload = function (e) {
						cppEditor.setValue(reader.result);
					};
					reader.readAsText(files[i]);
				}
			} else {
				alert('The File APIs are not fully supported in this browser.');
			}
		}
		var showJSprogramToggle = true;
		function showJSprogram(arg) {
			if (showJSprogramToggle) {
				cppEditor.save();
				var func = Psychlops.CodeConverter.compile($("#" + arg + "_cpp").val());
				$("#" + arg + "_cpp").parent().hide();
				jsEditor.setValue(func);
				$("#" + arg + "_js").parent().show();
				showJSprogramToggle = false;
			} else {
				$("#" + arg + "_js").parent().hide();
				$("#" + arg + "_cpp").parent().show();
				showJSprogramToggle = true;
			}

		}
		function saveToLocal() {
			Psychlops.File.downloadText(cppEditor.getValue(), $("#psychlops_save_to_local_filename").val() + ".cpp");
			return;
		}

		function infoFromFileName(filename) {
			var result = {};
			var reg = /(.*)(?:\.([^.]+$))/;
			if (reg.test(filename)) {
				var regd = filename.match(reg);
				result.basename = regd[1];
				result.ext = regd[2];
			} else {
				result.basename = filename;
				result.ext = "";
			}
			result.filename = filename;
			result.fileid = result.basename.replace(/[^0-9A-Za-z-_]/g, "_");
			return result;
		}
		function openNewTab() {
			makeNewTab('newfile');
		}
		function makeNewTab(filename) {
			var tabset = infoFromFileName(filename);
			tabSettings[filename] = tabset;

			var template = EDITOR_TEMPLATE.clone();
			var cpp_tab_id = 'tab_' + tabset.fileid + '_cpp';
			var js_tab_id = 'tab_' + tabset.fileid + '_js';
			template.attr('id', 'tab_' + tabset.fileid);
			template.attr('data-editorfile', filename + '.cpp');
			(template.find('#tab_default_cpp')).attr('id', cpp_tab_id);
			(template.find('#tab_default_js')).attr('id', js_tab_id);
			var autosave_button = template.find('#file_load_autosave_default'); autosave_button.attr('id', 'file_load_autosave_' + tabset.fileid);
			autosave_button.attr('onclick', "loadFromAutosave('" + filename + "');");
			var snapshot_button = template.find('#file_load_snapshot_default'); snapshot_button.attr('id', 'file_load_snapshot_' + tabset.fileid);
			snapshot_button.attr('onclick', "loadFromSnapshot('" + filename + "');");

			template.bind('keydown', function (event) {
				if (event.ctrlKey || event.metaKey) {
					switch (event.key) {
						case 'r':
							event.preventDefault();
							$('#run_button').trigger('click');
							break;
					}
				}
				switch (event.key) {
					case "F5":
						event.preventDefault();
						$('#run_button').trigger('click');
						break;
				}
			});

			template.removeClass('in');
			template.appendTo($('#editor_tabs_content'));

			tabSettings[filename].cppEditor = CodeMirror.fromTextArea(document.getElementById(cpp_tab_id), {
				mode: "text/x-c++src",
				viewportMargin: Infinity,
				matchBrackets: true,
				styleActiveLine: true,
				lineNumbers: true,
				lineWrapping: true,
				indentWithTabs: true,
				indentUnit: 4,
				tabSize: 4,
			});
			$("#" + cpp_tab_id).parent().hide();
			$("#" + js_tab_id).parent().show();
			$("#" + js_tab_id).val(Psychlops.CodeConverter.compile(document.getElementById(cpp_tab_id).value));
			tabSettings[filename].jsEditor = CodeMirror.fromTextArea(document.getElementById(js_tab_id), {
				mode: "javascript",
				viewportMargin: Infinity,
				matchBrackets: true,
				styleActiveLine: true,
				lineNumbers: true,
				lineWrapping: true,
				indentWithTabs: true,
				indentUnit: 4,
				tabSize: 4,
			});
			$("#" + js_tab_id).parent().hide();
			$("#" + cpp_tab_id).parent().show();

			snapshot_button.html("Load (" + confirmSnapshotTimestamp(filename) + ")");
			autosave_button.html("Load (" + confirmAutosaveTimestamp(filename) + ")");
			loadFromAutosave(filename);

			var template2 = $('<li id="tab_selector_' + tabset.fileid + '"><a href="#tab_' + tabset.fileid + '" data-toggle="tab">' + filename + '</a></li>');
			template2.prependTo($('#editor_tabs_menu'));
			template2.attr('data-filename', filename);
		}
		function updateCurrentEditor(e) {
			var filename;
			if (arguments.length == 0) {
				filename = $('#editor_tabs_menu li.active').attr('data-filename');
			} else {
				if (typeof e == "string") {
					filename = e;
				} else {
					filename = e.target.attr('data-filename');
				}
			}
			cppEditor = tabSettings[filename].cppEditor;
			jsEditor = tabSettings[filename].jsEditor;
			workingFile = filename;
		}

		function loadHelpMarkdown(title, filename, activation) {
			var id = filename.replace(/\//g, '').replace(/\./g, '');
			var tab_button = $('<li><a href="#Help' + id + '" data-toggle="tab">' + title + '</a></li>');
			var tab_pane = $('<div class="tab-pane fade" id="Help' + id + '"><iframe src="import/doc/reader.html#' + filename + '" />');
			$('#help_box > ul.nav').append(tab_button);
			$('#help_box > div.tab-content').append(tab_pane);
			if (activation) {
				$('.nav-tabs a[href="#Help' + id + '"]').tab('show');
			}
		}

		function notifyBottom(message) {
			var notify_bottom = $("#notify_bottom");
			notify_bottom.html(message);
			notify_bottom.fadeIn(600);
			window.setTimeout(function () { notify_bottom.fadeOut(600); }, 3000);
		}

		$(function () {
			var hash = null;
			var hash_tmp = null;
			var hash_file = null;
			if (window.location.hash) {
				hash = window.location.hash.replace(/%23/g, "#").substring(1);
				hash_tmp = hash.split("#");
				hash_file = hash_tmp.shift();
				args = hash_tmp;
			} else {
			}
			Psychlops.AppInfo.loadLocalSettings();

			var version = Psychlops.Util.getEnvironmentVersion();
			switch (version) {
				case Psychlops.Util.EnvironmentVersion.Latest:
					break;
				case Psychlops.Util.EnvironmentVersion.Env2013:
					$("#information_microsoft_").show();
					$("#tab_default_cpp").val($("#old_program").val());
					break;
			}
			EDITOR_TEMPLATE = $("#tab_default").clone();
			$("#tab_default").remove();

			var useragent = navigator.userAgent.toLowerCase();
			var useragentver = navigator.appVersion.toLowerCase();
			if ((useragent.indexOf('firefox') > -1)) { $("#information_sluggish").show(); }

			//// Run Psychlops ////
			Psychlops.Util.canvas_element_id = "glcanvas";
			Psychlops.Util.window_canvas_container_element_id = "window_canvas_container";
			Psychlops.Util.fullscreen_canvas_container_element_id = "fullscreen_canvas_container";
			Psychlops.Util.setConsoleTextarea("psychlops_console");
			Psychlops.Util.setThrobber("psychlops_throbber");
			Psychlops.Util.programFinishedCallback = function () {
				$("#psychlops_powersymbol").show();
				if (Psychlops.the_canvas._fullscreen) {
					$("#fullscreen_canvas_container").hide();
					$("#other_than_fullscreen_canvas_container").show();
				}
				loadConfiguration();
			};
			//Psychlops.Extensions.Visualize.setArea("plot_area", "plot_console");
			Psychlops.Variables.debugCallback = function () {
				$("#psychlops_watchlist").html(Psychlops.Variables.enumerateHTML());
			};
			Psychlops.Data.savearrayCallback = function (text, filename) {
				$("#savearray").val(text);
				$("#savearray_popup").show();

				//Psychlops.Extensions.Visualize.makePlottingConsole("plot_console");
			};
			Psychlops.Canvas.resizeCallback = function (width, height) {
				$("#window_canvas_container").css("width", width);
				$("#psychlops_canvas_modal").css("width", width + 200);
				$("#psychlops_canvas_modal").css("margin-left", -((width + 200) - 600) / 2);
			};
			Psychlops.Util.makeFullscreenCallback = function (width, height) {
				$("#other_than_fullscreen_canvas_container").hide();
				$("#fullscreen_canvas_container").show();
				$("#modal_stimuli").modal('hide');
			};



			//// source code editor ////
			var startfile = infoFromFileName('default.cpp');
			if (hash_file) startfile = infoFromFileName(hash_file);
			makeNewTab(startfile.filename);
			$("#editor_tabs_menu > li > a[href='#tab_" + startfile.fileid + "']").tab('show');
			updateCurrentEditor();
			$('#editor_tabs_menu').on('click', function () { window.setTimeout(updateCurrentEditor, 100); });

			$("#run_button").click(function () {
				cppEditor.save();
				if (Psychlops.Canvas.requirePopup) {
					if (RUN_WAIT != null) { window.clearInterval(RUN_WAIT); }
					$("#glcanvas").hide();
					var popupwindow = window.open("psychlops.popup.html", "psychlops_popup", "width=850, height=650, menubar=no, toolbar=no, scrollbars=yes");
				} else {
					run();
				}
			});

			document.getElementById('userimagefile').addEventListener('change', preloadImage, false);
			document.getElementById('usercppfile').addEventListener('change', loadFromLocal, false);

			$(window).bind('keydown', function (event) {
				if (event.ctrlKey || event.metaKey) {
					switch (String.fromCharCode(event.which).toLowerCase()) {
						case 's':
							event.preventDefault();
							var time = Date.now();
							if (time - CTRL_S_LAST_PUSHED > 1000) {
								saveToSnapshot(workingFile);
								CTRL_S_LAST_PUSHED = time;
							}
							break;
						case 'r':
							event.preventDefault();
							$('#run_button').trigger('click');
							break;
					}
				}
			});


			$("#psychlops_load_cpp_modal").on('show.bs.modal', function (event) {
				$("#onedrive_access_frame").insertAfter("#load_from_cloud_header");
			});
			$("#psychlops_save_cpp_modal").on('show.bs.modal', function (event) {
				$("#onedrive_access_frame").insertAfter("#save_to_cloud_header");
				$('#psychlops_save_to_cloud_url').val($("#tab_default").attr("data-editorfile"));
			});

			$(window).on("message", function (e) {
				if (e.originalEvent.origin !== WINDOW_MESSAGE_REQUESTER) { return; }
				var str = e.originalEvent.data;
				if (!(/\r\n|\r|\n/.test(str))) { str += '\n'; }
				var re = /[^\r\n]*(?:\r\n|\r|\n)/;
				var arr = re.exec(str);
				if (arr.index == 0) {
					var command_line = arr[0].trim();
					var data = str.substr(arr[0].length);
					arr = command_line.split(':');
					var command = arr.shift().trim();
					var parameter = arr;
				}

				switch (command) {
					case "signin":
						if (parameter[0] == 'success') {
							Psychlops.File.isOneDriveReady = true;
							Psychlops.File.saveToOneDriveCallback = function (fn, data) { saveToOneDrive(fn, data) };
							Psychlops.File.loadFromOneDriveCallback = null;
						}
						break;
					case "signout":
						if (parameter[0] == 'success') {
							$("#default_folder_selector").hide();
							Psychlops.File.isOneDriveReady = false;
							Psychlops.File.saveToOneDriveCallback = null;
							Psychlops.File.loadFromOneDriveCallback = null;
						}
						break;
					case "save":
						if (parameter[0] == 'success') {
							var extension = parameter[1].split(/\.(?=[^.]+$)/);
							switch (extension) {
								case 'cpp':
									$('#psychlops_save_cpp_modal').modal('hide');
									$("#tab_default").attr("data-editorfile", parameter[1]);
									$("#tab_selector_default").children().first().html(parameter[1]);
									break;
								default:
									break;
							}
						} else {
							alert('Finished to save ' + parameter[1] + " process. (result unknown)");
						}
						break;
					case "load":
						if (parameter[0] == 'success') {
							cppEditor.setValue(data);
							$("#tab_default").attr("data-editorfile", parameter[1]);
							$("#tab_selector_default").children().first().html(parameter[1]);
						} else {
							alert("Failed to load file from cloud.")
						}
						$('#psychlops_load_cpp_modal').modal('hide');
						break;
					case "enumFolder":
						if (parameter[0] == 'success') {
							var json = $.parseJSON(data);
							var html = "<ul class='file_selector' style='list-style-type: none'>";
							for (var i = 0; i < json.value.length; i++) {
								if (json.value[i].folder) {
									html += "<li><input onclick='getSelectedFile();' type='radio' name='file_selector_alts' value='" + json.value[i].name + "' data-onedriveid='" + json.value[i].id + "'> 📁 " + json.value[i].name + "</li>"
								} else if (json.value[i].file) {
									if (/.*\.cpp$/.test(json.value[i].name)) {
										html += "<li><input onclick='getSelectedFile();' type='radio' name='file_selector_alts' value='" + json.value[i].name + "' data-onedriveid='" + json.value[i].id + "'> " + json.value[i].name + "</li>"
									}
								}
							}
							html += "</ul>";
							$("#default_folder_selector").html(html);
							$("#default_folder_selector").show();
						}
						break;
				}
			});

			if (hash) {
				if (confirmAutosaveTimestamp(startfile.filename) != "no autosave") {
					notifyBottom("loaded auto-saved code.");
				} else {
					loadFromServer(startfile.filename);
				}
			}

			$.ajax({ url: "import/tests/gamma_by_eye.cpp", }).done(function (data) { CONFIGURE_GAMMA_CPP = data; });
			$.ajax({ url: "import/tests/MinimumMotion.cpp", }).done(function (data) { CONFIGURE_ISOLUMINANCE_CPP = data; });

			loadHelpMarkdown("Reference Manual", "import/doc/ReferenceManual.md", true);
			loadHelpMarkdown("Known Issues", "import/doc/KnownIssues.md");
		});
		function getSelectedFile() {
			//$('input[name="file_selector_alts"]:checked').attr('data-onedriveid');
			SELECTED_FILE = $('input[name="file_selector_alts"]:checked').val();
			if (/.*\.cpp$/.test(SELECTED_FILE)) { $("#psychlops_load_from_internet_url").val(SELECTED_FILE); }
		}

		function loadConfiguration() {
			$("#config_gamma_r").val(Psychlops.AppInfo.localSettings.GammaR ? Number(Psychlops.AppInfo.localSettings.GammaR) : 1.0);
			$("#config_gamma_g").val(Psychlops.AppInfo.localSettings.GammaG ? Number(Psychlops.AppInfo.localSettings.GammaG) : 1.0);
			$("#config_gamma_b").val(Psychlops.AppInfo.localSettings.GammaB ? Number(Psychlops.AppInfo.localSettings.GammaB) : 1.0);
			$("#config_isoluminant_r").val(Psychlops.AppInfo.localSettings.IsoluminantRatioR ? Number(Psychlops.AppInfo.localSettings.IsoluminantRatioR) : 0.2);
			$("#config_isoluminant_g").val(Psychlops.AppInfo.localSettings.IsoluminantRatioG ? Number(Psychlops.AppInfo.localSettings.IsoluminantRatioG) : 0.7);
			$("#config_isoluminant_b").val(Psychlops.AppInfo.localSettings.IsoluminantRatioB ? Number(Psychlops.AppInfo.localSettings.IsoluminantRatioB) : 0.1);
			if (!(typeof Psychlops.AppInfo.localSettings.TrueFullScreen == "undefined") && String(Psychlops.AppInfo.localSettings.TrueFullScreen) == "true") {
				$('input[name=fullscreen_mode]:eq(1)').prop('checked', true);
			} else {
				$('input[name=fullscreen_mode]:eq(0)').prop('checked', true);
			}
		}

		function sendFilesByMail() {
			Psychlops.File.DBallResultsCallback = function (list) {
				var address = "";//$("#send_mail_adress").val();
				var subject = "結果（" + (new Date()).toLocaleDateString("ja-JP") + "）";
				var body = JSON.stringify(list);
				/*
				var body = '\r\n';
				for (var i = 0; i < list.length; i++) {
					body += "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n";
					body += "filename: " + list[i].filename + "\r\n";
					body += "expname: " + list[i].expname + "\r\n";
					body += "participant: " + list[i].participant + "\r\n";
					body += "date: " + list[i].date + "\r\n";
					body += "@@@@@@@@@@@@@@@@\r\n";
					body += list[i].body + "\r\n\r\n";
				}*/
				var password = $("#send_mail_password").val();
				if (password == "") { alert("Please input password."); return; }
				var enc = encodeURIComponent(StanfordJavascriptCryptoLibrary.encrypt(password, body));
				$("#debug").val(enc)

				//var href = 'mailto:' + address + '?';
				//href += 'subject=' + subject + '&body=' + enc;
				//location.href = href;
				$('#send_mail_form').attr('action', "mailto:?Subject=" + subject);
				$("#results_encrypted").val(enc);
				$('#send_mail_form').submit();
			}
			Psychlops.File.DBgetAllResults();
		};
		function DBreset() {
			Psychlops.File.DBreset();
			alert("Result database was cleared.");
		}
		function countDB() {
			Psychlops.File.DBallResultsCallback = function (list) {
				var latest = 0, oldest = 0;
				for (var i = 0; i < list.length; i++) {
				}
				$("#data_transfer_numfiles").text(String(list.length));
				$("#data_transfer_latestfile").text("");
				$("#data_transfer_oldestfile").text("");
			}
			Psychlops.File.DBgetAllResults();
		}
		function saveConfiguration() {
			Psychlops.AppInfo.localSettings.GammaR = Number($("#config_gamma_r").val());
			Psychlops.AppInfo.localSettings.GammaG = Number($("#config_gamma_g").val());
			Psychlops.AppInfo.localSettings.GammaB = Number($("#config_gamma_b").val());
			Psychlops.AppInfo.localSettings.IsoluminantRatioR = Number($("#config_isoluminant_r").val());
			Psychlops.AppInfo.localSettings.IsoluminantRatioG = Number($("#config_isoluminant_g").val());
			Psychlops.AppInfo.localSettings.IsoluminantRatioB = Number($("#config_isoluminant_b").val());
			Psychlops.AppInfo.localSettings.TrueFullScreen = $('input[name=fullscreen_mode]:eq(1)').prop('checked') ? true : false;
			Psychlops.AppInfo.saveLocalSettings();
			$('#modal_config').modal('hide');
		}
		function configureColorGamma() {
			$("#psychlops_powersymbol").hide();
			Psychlops.Variables.debugMode = false;
			$('#psychlops_watchlist_area').hide();
			var func = Psychlops.CodeConverter.compile(CONFIGURE_GAMMA_CPP);
			Psychlops.Util.run(func);
		}
		function configureIsoluminance() {
			$("#psychlops_powersymbol").hide();
			Psychlops.Variables.debugMode = false;
			$('#psychlops_watchlist_area').hide();
			var func = Psychlops.CodeConverter.compile(CONFIGURE_ISOLUMINANCE_CPP);
			Psychlops.Util.run(func);
		}

		function toggleHelp() {
			//$('#editor_area').toggleClass('col-md-12');
			//$('#editor_area').toggleClass('col-md-6');
			//$('#help_box').toggleClass('col-md-6');
			//if ($('#help_box').hasClass('col-md-6')) {
			//	$('#help_box').css('display', 'block');
			//} else {
			//	$('#help_box').css('display', 'none');
			//}
			$('#help_box').toggle();
		}
	</script>
	<style type="text/css">
		html,
		body {
		}

		#page_flexbox {
			width: 100vw;
			height: 100vh;
			display: flex;
			flex-direction: column;
		}

		#page_header {
			flex: 0 0 auto;
		}

		#editor_menu {
			flex: 0 0 auto;
		}

		#editor_box {
			flex: 1 1 auto;
			overflow-y: scroll;
		}

		#page_footer {
			flex: 0 0 auto;
			z-index: 10;
			margin: 1em 1em 1em auto;
			text-align: right;
		}

		#default_folder_selector {
			width: 100%;
			height: 12em;
			margin: 0.5em 0.5em 0.5em 0;
			overflow-x: hidden;
			overflow-y: scroll;
			border: 1px solid black;
			display: none;
		}

		#file_selector li {
			margin-left: 1em;
		}

		.CodeMirror {
			height: auto;
			font-family: 'Roboto Mono', monospace;
		}

		.CodeMirror-matchingbracket {
			font-weight: bold;
		}

		.highlighted-code {
			background-color: lightgoldenrodyellow;
		}

		.highlighted-gatter {
			background-color: yellow;
		}

		.file_operation_menu {
			position: relative;
			top: 0;
			right: 0;
		}

		.file_operation_menu > div {
			z-index: 9;
			position: absolute;
			top: 0;
			right: 0;
		}

		.file_operation_menu .dropdown-menu a {
			cursor: pointer;
		}

		.active_code {
			background-color: #DDD;
			font: normal 10pt courier;
			border: none;
		}

		canvas:focus {
			outline: 0 invert none;
		}

		#window_canvas_container {
			text-align: center;
			vertical-align: middle;
		}

		#window_canvas_container canvas {
			margin: auto;
		}

		#psychlops_watchlist table {
			width: 100%;
			border-top: solid black 2px;
			border-bottom: solid black 2px;
		}

		#psychlops_watchlist th {
			border-bottom: solid black 1px;
		}

		#psychlops_watcher_value {
			width: 70%;
		}

		.version_notice {
			width: 85%;
			margin: 1em auto;
			padding: 0.5em;
			font-size: small;
			color: #444;
			background-color: gainsboro;
			border-radius: 0.5em;
			display: none;
		}

		#cpp_tab button {
			font-family: 'Cabin Condensed', sans-serif;
		}

		h1 {
			margin: 0;
			background: linear-gradient(#bdf, #eee);
			padding-top: 1ex;
			padding-left: 1em;
			font-family: 'Cabin Condensed', sans-serif;
			font-size: large;
			color: gray;
		}

		#psychlops_load_cpp_modal .h3 {
			margin-top: 2em;
		}

		#fulscreen_canvas_container {
			display: none;
		}

		#help_box {
			display: flex;
			flex-direction: column;
			align-items: stretch;
			height: 80vh;
			width: 50vw;
			border: 3px double gainsboro;
			border-radius: 5px;
			position: fixed;
			left: 50vw;
			top: 20vh;
			z-index: 99;
			box-shadow: 0px 0px 10px 10px rgba(0,0,0,0.2);
		}

		#help_box > ul.nav-tabs {
			flex-grow: 0;
			align-self: stretch;
		}

		#help_box > div.tab-content {
			flex-grow: 1;
			align-self: stretch;
			background-color: #EEE;
			position: relative;
		}

		#help_box > div > div.tab-pane {
			position: absolute;
			top: 0;
			right: 0;
			bottom: 0;
			left: 0;
			padding: 1ex;
		}

		#help_box > div > div.tab-pane > iframe {
			width: 100%;
			height: 100%;
			border: none;
		}
	</style>
</head>


<body>

	<div id="fullscreen_canvas_container" style="display:none">
	</div>

	<div id="DistanceWatcher" style="display:none">
	</div>

	<div id="other_than_fullscreen_canvas_container" style="">

		<div class="modal" id="modal_stimuli" tabindex="-1">
			<div class="modal-dialog">
				<div class="modal-content" id="psychlops_canvas_modal" style="width:1024px;margin-left: -60px;">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">
							<span aria-hidden="true">&times;</span>
						</button>
						<label class="checkbox-inline"><input data-toggle="toggle" data-size="small" type="checkbox" onchange="$('#psychlops_console').fadeToggle('fast');" />Console</label>
						<button type="button" class="btn btn-default" onclick="pauseProgram()" id="psychlops_pause_btn">❙❙ Pause</button>
						<button type="button" class="btn btn-default" onclick="restartProgram()" disabled="disabled" id="psychlops_restart_btn">▶ Restart</button>
					</div>

					<div class="modal-body" style="text-align:center">
						<div id="psychlops_powersymbol" style="width:100%; text-align:center; position:absolute; top:60px; color:blue; font-size:xx-large"><span class="glyphicon glyphicon-off"></span></div>
						<div id="window_canvas_container" style="display:inline-block; margin: 0 auto;position:relative; top:0; left:0;">
							<canvas id="glcanvas" width="800" height="600" tabindex="0">
								We are sorry, but your browser does not seem to support WebGL.
							</canvas>
							<div id="psychlops_throbber" style="position:relative; top:-250px; display:none;">The system is setting up the environment...<br /><img src="./import/images/throbber.gif" /></div>
						</div>

						<div style="text-align:center; margin:1em">
							<textarea id="psychlops_console" rows="5" style="display:none;width:95%;font: normal 8pt courier;"></textarea>
						</div>

						<div id="psychlops_watchlist_area" style="width:800px; margin: 0 auto; display:none;">
							<h4>Variables</h4>
							<div id="psychlops_watchlist" style="width:95%;font: normal 8pt courier;"></div>
						</div>
					</div>

					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal" data-toggle="modal" data-target="#modal_data">Results</button>
					</div>
				</div>
			</div>
		</div>

		<div id="psychlops_load_cpp_modal" class="modal fade" tabindex="-2">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">&times;</button>
						<h4 class="modal-title"><span class="glyphicon glyphicon-folder-open"></span> C++ load</h4>
					</div>
					<div class="modal-body">

						<div class="panel-group" id="accordion">
							<div class="panel panel-default">
								<div class="panel-heading">
									<h4 class="panel-title accordion-toggle">
										<a data-toggle="collapse" data-parent="#accordion" href="#load_from_default">Default</a>
									</h4>
								</div>
								<div id="load_from_default" class="panel-collapse collapse in">
									<div class="panel-body">
										<button class="btn btn-primary btn-sm" onclick="loadFromSnapshot('default');" title="open from temporary file"><span class="glyphicon glyphicon-camera"></span> Restore snapshot</button>
									</div>
								</div>
							</div>
							<div class="panel panel-default">
								<div class="panel-heading">
									<h4 class="panel-title accordion-toggle">
										<a data-toggle="collapse" data-parent="#accordion" href="#load_from_cloud" class="collapsed"><span class="glyphicon glyphicon-cloud-download"></span> Load from cloud</a>
									</h4>
								</div>
								<div id="load_from_cloud" class="panel-collapse collapse">
									<div class="panel-body">
										<span id="load_from_cloud_header"></span>
										<div style="margin: 0.5em;vertical-align:text-top;" id="onedrive_access_frame">
											<iframe src="https://psychlops.osdn.jp/secure/psychlops.OneDriveAccesser.html" id="onedriveaccesser" scrolling="no" style="border:none;width:30em;height:2em;"></iframe>
										</div>
										<div id="default_folder_selector"></div>
										<label></label><input id="psychlops_load_from_internet_url" type="text" size="50" /><br />
										<button type="button" class="btn btn-primary btn-sm" onclick="loadFromOneDrive($('#psychlops_load_from_internet_url').val());">Load C++ Code</button>
									</div>
								</div>
							</div>
							<div class="panel panel-default">
								<div class="panel-heading">
									<h4 class="panel-title accordion-toggle">
										<a data-toggle="collapse" data-parent="#accordion" href="#load_from_local" class="collapsed"><span class="glyphicon glyphicon-floppy-save"></span> Load from local</a>
									</h4>
								</div>
								<div id="load_from_local" class="panel-collapse collapse">
									<div class="panel-body">
										<input name="usercppfile" id="usercppfile" type="file" />
									</div>
								</div>
							</div>
						</div>

					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default btn-sm" data-dismiss="modal">Close</button>
					</div>
				</div>
			</div>
		</div>

		<div id="psychlops_save_cpp_modal" class="modal fade" tabindex="-2">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">&times;</button>
						<h4 class="modal-title"><span class="glyphicon glyphicon-floppy-disk"></span> C++ save</h4>
					</div>
					<div class="modal-body">
						<h3 id="save_to_cloud_header"><span class="glyphicon glyphicon-cloud-download"></span> Save to cloud</h3>
						<div id="default_folder_selector"></div>
						<label></label><input id="psychlops_save_to_cloud_url" type="text" size="50" /><br />
						<button type="button" class="btn btn-primary btn-sm" onclick="saveToOneDrive($('#psychlops_save_to_cloud_url').val(), cppEditor.getValue());">Save C++ Code</button>
						<h3><span class="glyphicon glyphicon-floppy-open"></span> Save to local</h3>
						<label>C++ filename: </label>
						<input id="psychlops_save_to_local_filename" type="text" size="30" value="" />.cpp<br />
						<button type="button" class="btn btn-primary btn-sm" onclick="saveToLocal();">Save C++ Code</button>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default btn-sm" data-dismiss="modal">Close</button>
					</div>
				</div>
			</div>
		</div>

		<div id="psychlops_loaded_images_modal" class="modal fade" tabindex="-3">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">&times;</button>
						<h4 class="modal-title"><span class="glyphicon glyphicon-picture"></span> Register images</h4>
					</div>
					<div class="modal-body">
						<h3><span class="glyphicon glyphicon-floppy-save"></span> Register local images</h3>
						<p style="background-color:#eee; border-radius:1ex; padding:0.5ex;">Pictures will not be uploaded on the internet; just local use.</p>
						<input name="userimagefile" id="userimagefile" type="file" multiple />
						<h3><span class="glyphicon glyphicon-picture"></span> Registered images</h3>
						<ul id="userimagefile_loaded"></ul>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					</div>
				</div>
			</div>
		</div>


		<div class="modal" id="modal_data" tabindex="-1">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">
							<span aria-hidden="true">&times;</span>
						</button>
						<h4 class="modal-title" id="modal-label">結果</h4>
					</div>

					<div class="modal-body">
						<textarea style="width:100%; height:10em;" id="savearray"></textarea>
						<div id="plot_console"></div>
						<div id="plot_area" style="width:400px; height:400px;"></div>
					</div>

					<div class="modal-footer">
						<button type="button" class="btn btn-primary" onclick="Psychlops.Data.invokeSavearray('results.txt')">保存(chromeのみ)</button>
						<button type="button" class="btn btn-default" data-dismiss="modal">閉じる</button>
					</div>
				</div>
			</div>
		</div>


		<div class="modal" id="modal_config" tabindex="-1">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">
							<span aria-hidden="true">&times;</span>
						</button>
						<h4 class="modal-title" id="modal-label">設定</h4>
					</div>

					<div class="modal-body">
						<h4>ガンマ調整</h4>
						<div>
							現在のガンマ値：<span id="current_gamma_setting">R:<input type="text" size="4" id="config_gamma_r" /> G:<input type="text" size="4" id="config_gamma_g" /> B:<input type="text" size="4" id="config_gamma_b" /></span>
							<button type="button" class="launcher btn btn-sm btn-success" onclick="configureColorGamma();">簡易調整</button>
						</div>
						<h4>等輝度調整</h4>
						<div>
							<p>ガンマ補正後に行ってください．</p>
							現在の輝度比率：<span id="current_isoluminant_setting">R:<input type="text" size="4" id="config_isoluminant_r" /> G:<input type="text" size="4" id="config_isoluminant_g" /> B:<input type="text" size="4" id="config_isoluminant_b" /></span>
							<button type="button" class="launcher btn btn-sm btn-success" onclick="configureIsoluminance();">簡易調整</button>
						</div>
						<h4>フルスクリーンモード</h4>
						<input type="radio" name="fullscreen_mode" value="false" />ウインドウ内<br />
						<input type="radio" name="fullscreen_mode" value="true" />画面全体（Windows, Mac OS Xでは時間精度が改善することがあります）
					</div>

					<div class="modal-footer">
						<button type="button" class="btn btn-primary" onclick="saveConfiguration();">保存</button>
						<button type="button" class="btn btn-default" onclick="loadConfiguration();" data-dismiss="modal">キャンセル</button>
					</div>
				</div>
			</div>
		</div>

		<div id="data_transfer_modal" class="modal fade" role="dialog">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">&times;</button>
						<h4 class="modal-title"><span class="glyphicon glyphicon-cog"></span> データ管理</h4>
					</div>
					<div class="modal-body">
						<div id="data_transfer_sendmail">
							<h4>保存されているファイル</h4>
							<div>
								ファイル数：<span id="data_transfer_numfiles"></span><br />
								最新の日付：<span id="data_transfer_latestfile"></span><br />
								最古の日付：<span id="data_transfer_oldestfile"></span><br />
								<button class="btn btn-primary btn-sm" onclick="DBreset();" style="margin-top:1em;">保存領域のリセット</button>
							</div>
							<h4>メール</h4>
							暗号化の上メーラで送信します
							<div>
								<label>暗号化パスワード: </label>
								<input type="password" id="send_mail_password" style="width:20em; border-top:none; border-left:none; border-right:none; border-bottom:2px solid black;" />
								<form method="post" action="mailto:?Subject=PsychlopsResults" id="send_mail_form" name="send_mail_form" enctype="text/plain" style="display:inline">
									<input style="display:none" type="hidden" name="results_encrypted" id="results_encrypted">
								</form>
								<button class="btn btn-primary btn-sm" onclick="sendFilesByMail();">送信</button>
								<div>
									<a href="../results/psychlops.decoder.html" target="_blank" class="btn btn-sm btn-success">decoder</a>
								</div>
							</div>
						</div>
						<div>
							<h4>OneDrive</h4>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					</div>
				</div>

			</div>
		</div>


		<div id="help_box" style="display:none;">
			<ul class="nav nav-tabs"></ul>
			<div class="tab-content"></div>
		</div>


		<div id="page_flexbox">
			<div id="page_header">
				<h1>Psychlops: Online Editor</h1>
				<div id="header2" style="text-align:right; right: 0; margin: 1em 1em 0 auto; position:absolute;">
					<button class="btn btn-default btn-sm" onclick="countDB();" href="#data_transfer_modal" data-toggle="modal"><span class="glyphicon glyphicon-share"></span></button>
					<button class="btn btn-default btn-sm" onclick="loadConfiguration();" href="#modal_config" data-toggle="modal"><span class="glyphicon glyphicon-cog"></span></button>
					<button class="btn btn-default btn-sm" onclick="toggleHelp();" data-toggle="button"><span class="glyphicon glyphicon-question-sign"></span> Manual</button>
				</div>

				<div style="margin:1em;">
					<button type="button" id="run_button" class="btn btn-primary" data-toggle="modal" data-target="#modal_stimuli">▶Compile & run</button>
					<label class="checkbox-inline"><input data-toggle="toggle" data-size="small" type="checkbox" onchange="$('#psychlops_console').fadeToggle('fast');" />Console</label>
					<label class="checkbox-inline"><input checked data-toggle="toggle" data-size="small" type="checkbox" id="debugmode_checkbox">Debug Mode</label>
					<button type="button" class="btn btn-default" data-dismiss="modal" data-toggle="modal" data-target="#modal_data"><span class="glyphicon glyphicon-stats"></span> Results</button>
					<button href="#psychlops_load_cpp_modal" class="btn btn-default" data-toggle="modal"><span class="glyphicon glyphicon-folder-open"></span> Open</button>
					<button href="#psychlops_save_cpp_modal" class="btn btn-default" data-toggle="modal"><span class="glyphicon glyphicon-floppy-disk"></span> Save</button>
					<button href="#psychlops_loaded_images_modal" class="btn btn-default" data-toggle="modal"><span class="glyphicon glyphicon-picture"></span> Images</button>
				</div>
				<div id="information_microsoft_edge" class="version_notice">
					このブラウザでは機能の一部が制限されます。完全な動作はChrome 39.0以上、Firefox 29.0以上、Opera 26.0以上、およびMicrosoft Edgeが必要です。
				</div>
				<div id="information_sluggish" class="version_notice">
					<span lang="ja">このブラウザのご使用のバージョンはWebGLのタイミング制御に問題があります。他のブラウザの使用をお勧めします。</span>
				</div>
			</div>

			<div id="editor_menu">
				<div style="padding:1ex;">
					<div class="btn-group" role="group">
						<!--<button class="btn btn-default btn-xs" onclick="loadFromTemporary();" title="open from temporary file"><span class="glyphicon glyphicon-open"></span>&#x200B;</button>-->
						<button class="btn btn-default btn-xs" onclick="saveToSnapshot(workingFile);" title="take snapshot of current code"><span class="glyphicon glyphicon-camera"></span>&#x200B;</button>
						<button class="btn btn-default btn-xs" onclick="saveToOneDrive($('#psychlops_save_to_cloud_url').val(), cppEditor.getValue());" title="take snapshot of current code"><span class="glyphicon glyphicon-floppy-disk"></span>&#x200B;</button>
					</div>
					<div class="btn-group" role="group">
						<button class="btn btn-default btn-xs" onclick="cppEditor.undo();">↶</button>
						<button class="btn btn-default btn-xs" onclick="cppEditor.redo();">↷</button>
					</div>
					<div class="btn-group" role="group">
						<button class="btn btn-default btn-xs" onclick="CodeMirror.commands.find(cppEditor);">🔍</button>
						<button class="btn btn-default btn-xs" onclick="CodeMirror.commands.replace(cppEditor);">⇄</button>

					</div>
				</div>
			</div>

			<div id="editor_box">

				<div id="source_code">

					<div id="editor_area">

						<ul class="nav nav-tabs" id="editor_tabs_menu">
							<!--<li class="active" id="tab_selector_default"><a href="#tab_default" data-toggle="tab">default.cpp</a></li>-->
							<li id="tab_append"><a onclick="openNewTab();">⊕</a></li>
						</ul>

						<div class="tab-content" id="editor_tabs_content">

							<div class="tab-pane fade in active" id="tab_default" data-editorfile="default.cpp">

								<div class="file_operation_menu">
									<div class="btn-group" role="group" aria-label="...">
										<div class="btn-group" role="group">
											<button type="button" class="btn btn-default dropdown-toggle btn-xs" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
												<span class="glyphicon glyphicon-camera"></span> snapshot
												<span class="caret"></span>
											</button>
											<ul class="dropdown-menu">
												<li><a onclick="loadFromSnapshot('default');" id="file_load_snapshot_default">Load</a></li>
												<li><a onclick="saveToSnapshot(workingFile);">Save</a></li>
											</ul>
										</div>
										<div class="btn-group" role="group">
											<button type="button" class="btn btn-default dropdown-toggle btn-xs" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
												<span class="glyphicon glyphicon-floppy-disk"></span> auto-save
												<span class="caret"></span>
											</button>
											<ul class="dropdown-menu">
												<li><a onclick="loadFromAutosave('default');" id="file_load_autosave_default">Load</a></li>
												<li><a onclick="saveToAutosave(workingFile);">Save</a></li>
												<li><a onclick="discardAutosave(workingFile);">discard autosave</a></li>
											</ul>
										</div>
										<li class="btn btn-default btn-xs" onclick="showJSprogram('tab_default');" data-toggle="button">javascript</li>
									</div>
								</div>

								<div>
									<textarea style="margin-left:2em; width:95%" id="tab_default_cpp">
#include <psychlops.h>
using namespace Psychlops;

void psychlops_main()
{
	Canvas cnvs(Canvas::window);


	Rectangle rect(100,100);

	while (!Keyboard::esc.pushed()) {
		cnvs.clear(Color(127 / 255.0));

		rect.centering().draw(Color::green);

		cnvs.flip();
	}
}

								</textarea>
									<textarea id="old_program" style="display:none">
#include <psychlops.h>
using namespace Psychlops;

void psychlops_main() {
	Canvas cnvs(Canvas::window);

	Rectangle rect(100,100);

	int progress = 0;
	int MAX_PROGRESS = 1;

	// [begin instruction]
	while (!Mouse::left.pushed()) {
		cnvs.clear(Color(127 / 255.0));
		cnvs.msg("Let's start Psychlops. Tap yout tablet or click left button.", 300, 300);
		cnvs.flip();
	}
	// [end instruction]

	// [begin session_loop]
	while (true) {
		if (progress > MAX_PROGRESS) {
			break;//endloop
		}

		// [begin blank]
		for (int i = 0; i < 60; i++) {
			cnvs.clear(Color(127 / 255.0));
			cnvs.flip();
		}
		// [end blank]

		// [begin trial_loop]
		while (true) {
			cnvs.clear(Color(127 / 255.0));
			if (Mouse::left.pushed()) {
				break;//endloop
			}

			rect.centering().draw(Color::green);

			cnvs.flip();
		}
		// [end trial_loop]

		progress++;
	}
	// [end session_loop]


	// [begin thanks]
	while (!Mouse::left.pushed()) {
		cnvs.clear(Color(127 / 255.0));
		cnvs.msg("Thank you!", 400, 300);
		cnvs.flip();
	}
	// [end thanks]
}
								</textarea>
								</div>
								<div style="display:none;">
									<textarea rows="60" style="margin-left:2em; width:95%" id="tab_default_js">// this form will be filled after compiling.</textarea>
								</div>
							</div>
						</div>
					</div>
				</div>

			</div>

			<div id="notify_bottom" style="display:none;border-radius:5px;background-color:#444444;color:white;font-weight:bold;padding:1em;text-align:center;position:fixed;top:calc(90vh + 10vh);left:50%;transform:translate(-50%, -150%);">
			</div>

			<div id="page_footer">
				© 2017 Psychlops development team.<br />
				The text editor is maintained by <a href="http://codemirror.net/">CodeMirror</a>.<br />
			</div>
		</div>

	</div>
</body>
</html>